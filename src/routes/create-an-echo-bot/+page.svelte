<!-- auto-generated by QWER -->
<script lang="ts">
  /* eslint-disable @typescript-eslint/ban-ts-comment */
  // @ts-nocheck
  import Post from '$lib/layouts/post.svelte';
  import ImgZoom from '$lib/components/image_zoom.svelte';
  import Video from '$lib/components/video.svelte';
  import CodeCopy from '$lib/components/code_copy.svelte';
  import InfoBox from '$lib/components/info_box.svelte';

  import NestedFolder from '$custom/NestedFolder.svelte';
  import type { Folder } from '$lib/types/folder';

  let webhookDirectory: Folder.Item = {
    name: 'MyBot',
    files: [
      {
        name: 'src',
        files: [
          {
            name: 'public',
            files: [{ name: 'index.php', icon: 'i-vscode-icons-file-type-php' }],
          },
          { name: 'bootstrap.php', icon: 'i-vscode-icons-file-type-php' },
          { name: 'envirorment.php', icon: 'i-vscode-icons-file-type-php' },
        ],
      },
      {
        name: 'vendor',
        files: [],
      },
      { name: 'composer.json', icon: 'i-vscode-icons-file-type-json' },
      { name: 'composer.lock', icon: 'i-vscode-icons-file-type-json' },
    ],
  };
</script>

<Post>
  <article slot="post_content">
    <h1 id="introduction"><a href="#introduction">Introduction</a></h1>
    <p>
      This article is part of the <a href="/?tags-Series=PHPBot">FirstBot</a>
      serie. We recommend reading the
      <a href="/create-your-first-bot">introcution chapter</a>
      before continuing.
    </p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-bash">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content"><span class="token function">composer</span> require telegramsdk/botapi</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h1 id="telegram-updates"><a href="#telegram-updates">Telegram Updates</a></h1>
    <p>Before writing the code we have to mention that there are 2 methods to get updates from our Telegram bot.</p>
    <ol>
      <li>
        <a href="https://core.telegram.org/bots/api#getupdates" rel="external">getUpdates</a>
        : used for long polling , usefull if you don&#39;t have a public ip or an https url.
      </li>
      <li>
        <a href="https://core.telegram.org/bots/api#setwebhook" rel="external">setWebhook</a>
        : more efficient way for recinving incoming updates, you need to have a public ip address with an https url.
      </li>
    </ol>
    <p>In this article we&#39;ll look into both ways of creating a Telegram Bot.</p>
    <h1 id="start-coding"><a href="#start-coding">üßë‚Äçüíª Start Coding</a></h1>
    <h2 id="get-updates"><a href="#get-updates">Get Updates</a></h2>
    <p>
      Here&#39;s a simple example on how to get updates from Telegram and reply to them with the same message they sent.
    </p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">bot.php</h2>
      <CodeCopy>
        <pre><code
            class="language-php">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content">&lt;?php</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content">define("PRODUCTION", false);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">require_once "vendor/autoload.php";</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">define("GREEN_TEXT", "\033[0;32m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content">define("RED_TEXT", "\033[0;31m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">define("DEFAULT_TEXT", "\033[0m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content">use TelegramSDK\BotAPI\Telegram\Bot;</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">10</span><span class="no-line-diff"></span></div><div class="code-content">&#36;bot = new Bot("YOUR_BOT_TOKEN", Bot::UPDATES_FROM_GET_UPDATES);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">11</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">12</span><span class="no-line-diff"></span></div><div class="code-content">echo GREEN_TEXT . "Bot Started!\n" . DEFAULT_TEXT;</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">13</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">14</span><span class="no-line-diff"></span></div><div class="code-content">while(true){</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">15</span><span class="no-line-diff"></span></div><div class="code-content">    &#36;updates = &#36;bot-&gt;updates(true, &#36;updates-&gt;lastUpdateID ?? null);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">16</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">17</span><span class="no-line-diff"></span></div><div class="code-content">    foreach(&#36;updates-&gt;result as &#36;update){</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">18</span><span class="no-line-diff"></span></div><div class="code-content">        if(isset(&#36;update-&gt;message)){</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">19</span><span class="no-line-diff"></span></div><div class="code-content">            &#36;res = &#36;bot-&gt;copyMessage([</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">20</span><span class="no-line-diff"></span></div><div class="code-content">                "chat_id" =&gt; &#36;update-&gt;chat-&gt;id,</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">21</span><span class="no-line-diff"></span></div><div class="code-content">                "from_chat_id" =&gt; &#36;update-&gt;chat-&gt;id,</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">22</span><span class="no-line-diff"></span></div><div class="code-content">                "message_id" =&gt; &#36;update-&gt;message-&gt;message_id</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">23</span><span class="no-line-diff"></span></div><div class="code-content">            ]);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">24</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">25</span><span class="no-line-diff"></span></div><div class="code-content">            if(&#36;res-&gt;body-&gt;ok){</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">26</span><span class="no-line-diff"></span></div><div class="code-content">                echo GREEN_TEXT . "Replied to " . &#36;update-&gt;chat-&gt;id . "\n" . DEFAULT_TEXT;</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">27</span><span class="no-line-diff"></span></div><div class="code-content">            } else{</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">28</span><span class="no-line-diff"></span></div><div class="code-content">                echo RED_TEXT . "Coulnd't reply to " . &#36;update-&gt;chat-&gt;id . ": " . &#36;res-&gt;body-&gt;error . "\n" . DEFAULT_TEXT;</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">29</span><span class="no-line-diff"></span></div><div class="code-content">            }</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">30</span><span class="no-line-diff"></span></div><div class="code-content">        }</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">31</span><span class="no-line-diff"></span></div><div class="code-content">    }</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">32</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">33</span><span class="no-line-diff"></span></div><div class="code-content">    sleep(5);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">34</span><span class="no-line-diff"></span></div><div class="code-content">}</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h3 id="what-am-i-doing"><a href="#what-am-i-doing">ü§î What Am I Doing?</a></h3>
    <p>
      If you already worked with <a href="https://github.com/TelegramSDK/BotAPI" rel="external">TelegramSDK</a>
      you might already know what I&#39;ve just written, but I still reccommend having a look at the
      <a href="https://botapi.racca.me/docs/examples/echo-bot" rel="external">official documentation</a>
      where this example is explained.
    </p>
    <h4 id="definitions"><a href="#definitions">Definitions</a></h4>
    <p>
      <a href="https://botapi.racca.me" rel="external">TelegramSDK</a>
      uses the
      <code class="inline-code-block">PRODUCTION</code>
      as the method to show errors. Here&#39;s how it works:
    </p>
    <ul>
      <li>
        <code class="inline-code-block">false</code>
        : set
        <code class="inline-code-block">PRODUCTION</code>
        to
        <code class="inline-code-block">false</code>
        to throw exceptions whenever there is an API error;
      </li>
      <li>
        <code class="inline-code-block">true</code>
        : set
        <code class="inline-code-block">PRODUCTION</code>
        to
        <code class="inline-code-block">true</code>
        to suppress exceptions and throw warnings instead.
      </li>
    </ul>
    <p>The other definitions are useful in our program to output the result of every API call.</p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">bot.php</h2>
      <CodeCopy>
        <pre><code
            class="language-php">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content">&lt;?php</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content">define("PRODUCTION", false);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">require_once "vendor/autoload.php";</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">define("GREEN_TEXT", "\033[0;32m");</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content">define("RED_TEXT", "\033[0;31m");</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">define("DEFAULT_TEXT", "\033[0m");</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h4 id="instancing-a-new-bot"><a href="#instancing-a-new-bot">Instancing a new Bot</a></h4>
    <p>
      In this lines we&#39;re importing the library from the <code class="inline-code-block">vendor/</code>
      directory and instancing a new Bot object.
    </p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">bot.php</h2>
      <CodeCopy>
        <pre><code
            class="language-php">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content">&lt;?php</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content">define("PRODUCTION", false);</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">require_once "vendor/autoload.php";</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">define("GREEN_TEXT", "\033[0;32m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content">define("RED_TEXT", "\033[0;31m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">define("DEFAULT_TEXT", "\033[0m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content">use TelegramSDK\BotAPI\Telegram\Bot;</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">10</span><span class="no-line-diff"></span></div><div class="code-content">&#36;bot = new Bot("YOUR_BOT_TOKEN", Bot::UPDATES_FROM_GET_UPDATES);</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <InfoBox statusType="info" statusName="Replace the Token!">
      <p>
        Please remember to replace <code class="inline-code-block">YOUR_BOT_TOKEN</code>
        with the actual bot token that
        <a href="https://t.me/botfather" rel="external">@botfather</a>
        sent you.
      </p>
      <p>
        See &quot;
        <a href="/create-your-first-bot#setup-your-bot-on-telegram">Setup your Bot on Telegram</a>
        &quot; if you don&#39;t know how to do it.
      </p>
    </InfoBox>
    <h4 id="getting-the-updates"><a href="#getting-the-updates">Getting the updates</a></h4>
    <ul>
      <li>
        <code class="inline-code-block">while&lpar;1&rpar;</code>
        is used to to continuously
        <a href="(https://en.wikipedia.org/wiki/Push_technology#Long_polling)" rel="external">poll</a>
        the Telegram server for new updates.
      </li>
      <li>
        <code class="inline-code-block">sleep&lpar;5&rpar;</code>
        creates an interval from each request to aviod getting timed out.
      </li>
      <li>
        <code class="inline-code-block">$bot-&gt;updates&lpar;&rpar;</code>
        is one of the few built-in functions of the
        <a href="https://botapi.racca.me/docs/usage/general" rel="external">Bot</a>
        class. See
        <a href="https://botapi.racca.me/docs/usage/updates#default-updates" rel="external">Default Updates</a>
        for the first parameter. The second parameter sets the last update to get only the most recent ones.
      </li>
    </ul>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">bot.php</h2>
      <CodeCopy>
        <pre><code
            class="language-php">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content">&lt;?php</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content">define("PRODUCTION", false);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">require_once "vendor/autoload.php";</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">define("GREEN_TEXT", "\033[0;32m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content">define("RED_TEXT", "\033[0;31m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">define("DEFAULT_TEXT", "\033[0m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content">use TelegramSDK\BotAPI\Telegram\Bot;</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">10</span><span class="no-line-diff"></span></div><div class="code-content">&#36;bot = new Bot("YOUR_BOT_TOKEN", Bot::UPDATES_FROM_GET_UPDATES);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">11</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">12</span><span class="no-line-diff"></span></div><div class="code-content">echo GREEN_TEXT . "Bot Started!\n" . DEFAULT_TEXT;</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">13</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">14</span><span class="no-line-diff"></span></div><div class="code-content">while(true){</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">15</span><span class="no-line-diff"></span></div><div class="code-content">    &#36;updates = &#36;bot-&gt;updates(true, &#36;updates-&gt;lastUpdateID ?? null);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">16</span><span class="no-line-diff"></span></div><div class="code-content">    ...</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">17</span><span class="no-line-diff"></span></div><div class="code-content">    sleep(5);</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">18</span><span class="no-line-diff"></span></div><div class="code-content">}</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h4 id="replying-to-the-user"><a href="#replying-to-the-user">Replying to the user</a></h4>
    <p>
      Once we have received the update we can finally reply to the user with the same message they sent by just copying
      it with <a href="https://core.telegram.org/bots/api#copymessage" rel="external">copyMessage</a>
      .
    </p>
    <ul>
      <li>
        <code class="inline-code-block">foreach&lpar;$updates-&gt;result as $update&rpar;</code>
        loops through the updates
      </li>
      <li>
        <code class="inline-code-block">if&lpar;isset&lpar;$update-&gt;message&rpar;&rpar;</code>
        check if a message was sent. See the
        <a href="https://core.telegram.org/bots/api#update" rel="external">update</a>
        object.
      </li>
      <li>
        <code class="inline-code-block">$bot-&gt;copyMessage&lpar;&rpar;</code>
        copies the message and sends it to the user that sent the update (
        <code class="inline-code-block">$update-&gt;chat-&gt;id</code>
        ).
      </li>
      <li>
        <code class="inline-code-block">if&lpar;$res-&gt;body-&gt;ok&rpar;</code>
        checks if the message was sent successfully.
      </li>
    </ul>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">bot.php</h2>
      <CodeCopy>
        <pre><code
            class="language-php">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content">&lt;?php</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content">define("PRODUCTION", false);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">require_once "vendor/autoload.php";</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">define("GREEN_TEXT", "\033[0;32m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content">define("RED_TEXT", "\033[0;31m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">define("DEFAULT_TEXT", "\033[0m");</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content">use TelegramSDK\BotAPI\Telegram\Bot;</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">10</span><span class="no-line-diff"></span></div><div class="code-content">&#36;bot = new Bot("YOUR_BOT_TOKEN", Bot::UPDATES_FROM_GET_UPDATES);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">11</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">12</span><span class="no-line-diff"></span></div><div class="code-content">echo GREEN_TEXT . "Bot Started!\n" . DEFAULT_TEXT;</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">13</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">14</span><span class="no-line-diff"></span></div><div class="code-content">while(true){</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">15</span><span class="no-line-diff"></span></div><div class="code-content">    &#36;updates = &#36;bot-&gt;updates(true, &#36;updates-&gt;lastUpdateID ?? null);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">16</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">17</span><span class="no-line-diff"></span></div><div class="code-content">    foreach(&#36;updates-&gt;result as &#36;update){</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">18</span><span class="no-line-diff"></span></div><div class="code-content">        if(isset(&#36;update-&gt;message)){</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">19</span><span class="no-line-diff"></span></div><div class="code-content">            &#36;res = &#36;bot-&gt;copyMessage([</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">20</span><span class="no-line-diff"></span></div><div class="code-content">                "chat_id" =&gt; &#36;update-&gt;chat-&gt;id,</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">21</span><span class="no-line-diff"></span></div><div class="code-content">                "from_chat_id" =&gt; &#36;update-&gt;chat-&gt;id,</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">22</span><span class="no-line-diff"></span></div><div class="code-content">                "message_id" =&gt; &#36;update-&gt;message-&gt;message_id</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">23</span><span class="no-line-diff"></span></div><div class="code-content">            ]);</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">24</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">25</span><span class="no-line-diff"></span></div><div class="code-content">            if(&#36;res-&gt;body-&gt;ok){</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">26</span><span class="no-line-diff"></span></div><div class="code-content">                echo GREEN_TEXT . "Replied to " . &#36;update-&gt;chat-&gt;id . "\n" . DEFAULT_TEXT;</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">27</span><span class="no-line-diff"></span></div><div class="code-content">            } else{</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">28</span><span class="no-line-diff"></span></div><div class="code-content">                echo RED_TEXT . "Coulnd't reply to " . &#36;update-&gt;chat-&gt;id . ": " . &#36;res-&gt;body-&gt;error . "\n" . DEFAULT_TEXT;</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">29</span><span class="no-line-diff"></span></div><div class="code-content">            }</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">30</span><span class="no-line-diff"></span></div><div class="code-content">        }</div></div><div class="code-line line-highlight"><div class="code-linenotation"><span class="line-number">31</span><span class="no-line-diff"></span></div><div class="code-content">    }</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">32</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">33</span><span class="no-line-diff"></span></div><div class="code-content">    sleep(5);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">34</span><span class="no-line-diff"></span></div><div class="code-content">}</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h3 id="start-the-bot"><a href="#start-the-bot">Start the Bot</a></h3>
    <p>That&#39;s it, now you can start the bot with</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-bash">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">php bot.php</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>Send to it a message and see it replying!</p>
    <h2 id="set-webhook"><a href="#set-webhook">Set Webhook</a></h2>
    <p>
      Setting a <a href="https://core.telegram.org/bots/api#setwebhook" rel="external">webhook</a>
      with Telegram is bit more complicated than working with
      <a href="https://core.telegram.org/bots/api#getupdates" rel="external">getUpdates</a>
      as it requires an HTTPS url. In this article will assume that you already have it.
    </p>
    <h3 id="directory-structure"><a href="#directory-structure">Directory Structure</a></h3>
    <p>Here&#39;s an example of directory structure you might follow:</p>
    <div class="p4 border-1 shadow-xl rounded-xl border-black dark:border-white overflow-auto">
      <NestedFolder folderData={webhookDirectory} />
    </div>

    <h3 id="envirorment"><a href="#envirorment">Envirorment</a></h3>
    <p>
      Let&#39;s start with <code class="inline-code-block">envirorment.php</code>
      , a file that will hamdle common tasks such as creating a new instance of the bot.
    </p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">src/envirorment.php</h2>
      <CodeCopy>
        <pre><code
            class="language-php">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content">&lt;?php</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">define("PRODUCTION", false);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">require_once __DIR__ . "/../vendor/autoload.php";</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">use TelegramSDK\BotAPI\Telegram\Bot;</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content">&#36;bot = new Bot("YOUR_BOT_TOKEN", Bot::UPDATES_FROM_WEBHOOK);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">10</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">11</span><span class="no-line-diff"></span></div><div class="code-content">&#36;update = &#36;bot-&gt;updates(true); // Getting the updates</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      As you can see, getting updates from the webhook is much easier than doing it with <code
        class="inline-code-block">
        getUpdates
      </code>
      .
    </p>
    <h3 id="bootstrap"><a href="#bootstrap">Bootstrap</a></h3>
    <p>
      The <code class="inline-code-block">bootstrap.php</code>
      file simply sets the webhook to the specified url.
    </p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">src/bootstrap.php</h2>
      <CodeCopy>
        <pre><code
            class="language-php">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content">&lt;?php</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">require_once __DIR__ . "/envirorment.php";</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">&#36;bot-&gt;setWebhook([</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content">    "url" =&gt; "https://example.com", // Remember to use https</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">    "drop_pending_updates" =&gt; true,</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content">]);</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <p>
      See <a href="https://core.telegram.org/bots/api#setwebhook" rel="external">setWebhook</a>
      for more information.
    </p>
    <h3 id="public-file"><a href="#public-file">Public file</a></h3>
    <p>
      The <code class="inline-code-block">src/public/</code>
      directory will be the one exposed to your web server and it will contain only one file,
      <code class="inline-code-block">index.php</code>
    </p>
    <div class="code-block titled showLineNumber">
      <h2 class="code-title">src/public/index.php</h2>
      <CodeCopy>
        <pre><code
            class="language-php">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="line-number">1</span><span class="no-line-diff"></span></div><div class="code-content">&lt;?php</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">2</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">3</span><span class="no-line-diff"></span></div><div class="code-content">require_once __DIR__ . "/../envirorment.php";</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">4</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">5</span><span class="no-line-diff"></span></div><div class="code-content">if(isset(&#36;update-&gt;update_id)){ // Check if there is an update</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">6</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">7</span><span class="no-line-diff"></span></div><div class="code-content">    if(isset(&#36;update-&gt;message)){ // Check if a message was sent</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">8</span><span class="no-line-diff"></span></div><div class="code-content">        &#36;bot-&gt;copyMessage([ // Copy the message</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">9</span><span class="no-line-diff"></span></div><div class="code-content">            "chat_id" =&gt; &#36;update-&gt;chat-&gt;id,</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">10</span><span class="no-line-diff"></span></div><div class="code-content">            "from_chat_id" =&gt; &#36;update-&gt;chat-&gt;id,</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">11</span><span class="no-line-diff"></span></div><div class="code-content">            "message_id" =&gt; &#36;update-&gt;message-&gt;message_id</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">12</span><span class="no-line-diff"></span></div><div class="code-content">        ]);</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">13</span><span class="no-line-diff"></span></div><div class="code-content">    }</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">14</span><span class="no-line-diff"></span></div><div class="code-content"></div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">15</span><span class="no-line-diff"></span></div><div class="code-content">} else{</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">16</span><span class="no-line-diff"></span></div><div class="code-content">    echo "No updates from telegram where found.\n";</div></div><div class="code-line"><div class="code-linenotation"><span class="line-number">17</span><span class="no-line-diff"></span></div><div class="code-content">}</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h3 id="start-the-bot"><a href="#start-the-bot">Start the bot</a></h3>
    <p>Once you have those files you just need to bootstrap your bot:</p>
    <div class="code-block">
      <CodeCopy>
        <pre><code
            class="language-bash">{@html String.raw`<div class="code-line"><div class="code-linenotation"><span class="no-line-number"></span><span class="no-line-diff"></span></div><div class="code-content">php src/bootstrap.php</div></div>`}</code></pre>
      </CodeCopy>
    </div>
    <h1 id="enjoy"><a href="#enjoy">Enjoy</a></h1>
    <p>You now have a full functioning bot that replies to every message sent by the users.</p>
    <p>If you have any question please leave a comment below and I&#39;ll be happy to reply.</p>
  </article>
</Post>
